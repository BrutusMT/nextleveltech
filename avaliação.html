<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia Interativo de Formata√ß√£o de Computadores</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals & Soft Teal -->
    <!-- Application Structure Plan: A multi-section single-page application (SPA) designed as a guided learning journey. The structure uses a top navigation bar for easy access to thematic sections. This non-linear, task-oriented structure was chosen over a simple report layout to enhance user engagement. The core of the application is the interactive quiz, which turns passive learning into an active assessment. -->
    <!-- Visualization & Content Choices: HTML table for comparisons, step-by-step diagram for process, Chart.js bar chart for data units, and interactive quiz form. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .nav-link { transition: color 0.3s, border-bottom-color 0.3s; }
        .nav-link.active { color: #0d9488; border-bottom-color: #0d9488; }
        .quiz-option { transition: background-color 0.2s; }
        .quiz-option:hover { background-color: #f0f9ff; }
        .quiz-option.selected { background-color: #e0f2fe; border-color: #38bdf8; }
        .quiz-option.correct { background-color: #dcfce7; border-color: #22c55e; }
        .quiz-option.incorrect { background-color: #fee2e2; border-color: #ef4444; }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto; height: 350px; max-height: 500px; }
        @media (min-width: 768px) { .chart-container { height: 450px; } }
        /* Style for disabled button */
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <a href="#inicio" class="text-xl font-bold text-teal-700">Guia de Formata√ß√£o</a>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#conceitos" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600 hover:text-teal-600 border-b-2 border-transparent">Conceitos</a>
                        <a href="#processo" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600 hover:text-teal-600 border-b-2 border-transparent">Processo</a>
                        <a href="#seguranca" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600 hover:text-teal-600 border-b-2 border-transparent">Seguran√ßa</a>
                        <a href="#quiz" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-600 hover:text-teal-600 border-b-2 border-transparent">Quiz Interativo</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-slate-500 hover:text-white hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-teal-600 focus:ring-white">
                        <span class="sr-only">Abrir menu principal</span>
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
            <div id="mobile-menu" class="hidden md:hidden">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="#conceitos" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-slate-600 hover:text-teal-600">Conceitos</a>
                    <a href="#processo" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-slate-600 hover:text-teal-600">Processo</a>
                    <a href="#seguranca" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-slate-600 hover:text-teal-600">Seguran√ßa</a>
                    <a href="#quiz" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-slate-600 hover:text-teal-600">Quiz Interativo</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

        <!-- Se√ß√£o de Introdu√ß√£o -->
        <section id="inicio" class="text-center mb-16 md:mb-24">
            <h1 class="text-4xl md:text-5xl font-extrabold text-teal-700 mb-4">Desvendando a Formata√ß√£o</h1>
            <p class="max-w-3xl mx-auto text-lg text-slate-600">Um guia essencial para otimizar o desempenho, garantir a seguran√ßa e entender o ciclo de vida dos dados no seu computador.</p>
        </section>

        <!-- Se√ß√£o de Conceitos -->
        <section id="conceitos" class="mb-16 md:mb-24 scroll-mt-16">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold mb-2">Conceitos Fundamentais</h2>
                <p class="text-md text-slate-500">Tudo come√ßa com o entendimento do "o qu√™" e do "porqu√™". Explore os conceitos b√°sicos que definem a formata√ß√£o.</p>
            </div>

            <div class="bg-white p-8 rounded-xl shadow-lg mb-12">
                <h3 class="text-2xl font-semibold mb-4 text-teal-700">O que √© Formata√ß√£o?</h3>
                <p class="text-slate-600 mb-6">A formata√ß√£o √© um processo t√©cnico que remove todos os dados de um disco (HD ou SSD) e o prepara para um novo uso. √â uma etapa crucial na reinstala√ß√£o de um sistema operacional (como Windows, macOS ou Linux), restaurando o computador a um estado inicial, como se fosse rec√©m-sa√≠do da f√°brica. Este procedimento n√£o s√≥ libera espa√ßo, mas tamb√©m resolve problemas de desempenho e seguran√ßa.</p>
                <div class="grid md:grid-cols-3 gap-6 text-center">
                    <div class="bg-slate-100 p-4 rounded-lg">
                        <h4 class="font-semibold">üßπ Limpeza Total</h4>
                        <p class="text-sm text-slate-500">Apaga todos os dados e configura o disco para receber novas informa√ß√µes.</p>
                    </div>
                    <div class="bg-slate-100 p-4 rounded-lg">
                        <h4 class="font-semibold">‚öôÔ∏è Prepara√ß√£o do Dispositivo</h4>
                        <p class="text-sm text-slate-500">Deixa HDs e SSDs prontos para a instala√ß√£o de um novo sistema.</p>
                    </div>
                    <div class="bg-slate-100 p-4 rounded-lg">
                        <h4 class="font-semibold">‚ú® Sistema Novo em Folha</h4>
                        <p class="text-sm text-slate-500">Reinstala o sistema operacional, devolvendo a agilidade original.</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-8 rounded-xl shadow-lg mb-12">
                <h3 class="text-2xl font-semibold mb-4 text-teal-700">Formata√ß√£o R√°pida vs. Completa</h3>
                <p class="text-slate-600 mb-6">Existem dois tipos principais de formata√ß√£o. Compreender a diferen√ßa √© crucial para garantir a seguran√ßa e a integridade das suas informa√ß√µes. A escolha errada pode deixar seus dados vulner√°veis.</p>
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-100">
                            <tr>
                                <th class="p-4 font-semibold border-b border-slate-200">Caracter√≠stica</th>
                                <th class="p-4 font-semibold border-b border-slate-200">Formata√ß√£o R√°pida</th>
                                <th class="p-4 font-semibold border-b border-slate-200">Formata√ß√£o Completa</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="hover:bg-slate-50">
                                <td class="p-4 border-b border-slate-200 font-medium">M√©todo</td>
                                <td class="p-4 border-b border-slate-200">Apaga apenas os √≠ndices dos arquivos.</td>
                                <td class="p-4 border-b border-slate-200">Apaga os √≠ndices e sobrescreve os dados.</td>
                            </tr>
                            <tr class="hover:bg-slate-50">
                                <td class="p-4 border-b border-slate-200 font-medium">Velocidade</td>
                                <td class="p-4 border-b border-slate-200">Muito mais r√°pida.</td>
                                <td class="p-4 border-b border-slate-200">Consideravelmente mais demorada.</td>
                            </tr>
                             <tr class="hover:bg-slate-50">
                                <td class="p-4 border-b border-slate-200 font-medium">Seguran√ßa</td>
                                <td class="p-4 border-b border-slate-200">Baixa. Dados podem ser recuperados.</td>
                                <td class="p-4 border-b border-slate-200">Alta. Recupera√ß√£o quase imposs√≠vel.</td>
                            </tr>
                            <tr class="hover:bg-slate-50">
                                <td class="p-4 border-b border-slate-200 font-medium">Verifica√ß√£o de Disco</td>
                                <td class="p-4 border-b border-slate-200">N√£o verifica a integridade f√≠sica.</td>
                                <td class="p-4 border-b border-slate-200">Verifica o disco por setores defeituosos.</td>
                            </tr>
                            <tr class="hover:bg-slate-50">
                                <td class="p-4 font-medium">Uso Ideal</td>
                                <td class="p-4">Reinstalar o SO rapidamente em um PC pessoal.</td>
                                <td class="p-4">Vender/doar o PC, ou se h√° suspeita de problemas no disco.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="bg-white p-8 rounded-xl shadow-lg">
                 <h3 class="text-2xl font-semibold mb-4 text-teal-700">Unidades de Armazenamento Digital</h3>
                <p class="text-slate-600 mb-6">Do menor pulso el√©trico ao maior data center, os dados s√£o medidos em unidades que crescem exponencialmente. O gr√°fico abaixo ilustra a escala massiva, mostrando quantos da unidade anterior cabem em cada nova unidade (escala logar√≠tmica).</p>
                <div class="chart-container">
                    <canvas id="storageChart"></canvas>
                </div>
            </div>

        </section>

        <!-- Se√ß√£o de Processo -->
        <section id="processo" class="mb-16 md:mb-24 scroll-mt-16">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold mb-2">O Processo de Formata√ß√£o Segura</h2>
                <p class="text-md text-slate-500">Siga estes passos para garantir uma formata√ß√£o bem-sucedida, sem perda de dados importantes.</p>
            </div>
            
            <div class="relative">
                <div class="absolute left-1/2 -ml-0.5 w-1 h-full bg-teal-200 hidden md:block" aria-hidden="true"></div>
                <div class="space-y-12 md:space-y-16">
                    <!-- Passo 1 -->
                    <div class="relative flex items-start md:items-center md:space-x-8">
                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-teal-500 text-white flex items-center justify-center font-bold text-lg z-10">1</div>
                        <div class="flex-grow bg-white p-6 rounded-xl shadow-lg">
                            <h4 class="text-xl font-semibold mb-2">Backup de Dados: A Etapa Cr√≠tica</h4>
                            <p class="text-slate-600">Antes de tudo, copie seus arquivos essenciais (fotos, documentos, etc.) para um disco externo ou servi√ßo de nuvem. Esta √© sua √∫nica ap√≥lice de seguro contra a perda permanente de dados.</p>
                        </div>
                    </div>
                    <!-- Passo 2 -->
                    <div class="relative flex items-start md:items-center md:space-x-8">
                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-teal-500 text-white flex items-center justify-center font-bold text-lg z-10">2</div>
                        <div class="flex-grow bg-white p-6 rounded-xl shadow-lg">
                            <h4 class="text-xl font-semibold mb-2">Reinstala√ß√£o do Sistema Operacional</h4>
                            <p class="text-slate-600">Utilize um pendrive boot√°vel ou DVD com a imagem do sistema operacional (Windows, macOS, Linux) para iniciar o processo de instala√ß√£o ap√≥s a formata√ß√£o do disco.</p>
                        </div>
                    </div>
                    <!-- Passo 3 -->
                    <div class="relative flex items-start md:items-center md:space-x-8">
                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-teal-500 text-white flex items-center justify-center font-bold text-lg z-10">3</div>
                        <div class="flex-grow bg-white p-6 rounded-xl shadow-lg">
                            <h4 class="text-xl font-semibold mb-2">Instala√ß√£o de Drivers</h4>
                            <p class="text-slate-600">Ap√≥s instalar o SO, instale os drivers do fabricante para todos os componentes de hardware (placa de v√≠deo, som, rede). Isso √© crucial para o bom funcionamento do sistema.</p>
                        </div>
                    </div>
                    <!-- Passo 4 -->
                    <div class="relative flex items-start md:items-center md:space-x-8">
                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-teal-500 text-white flex items-center justify-center font-bold text-lg z-10">4</div>
                        <div class="flex-grow bg-white p-6 rounded-xl shadow-lg">
                            <h4 class="text-xl font-semibold mb-2">Instala√ß√£o de Programas</h4>
                            <p class="text-slate-600">Instale seus programas essenciais, como navegador de internet, pacote de escrit√≥rio e outros aplicativos que voc√™ usa no dia a dia.</p>
                        </div>
                    </div>
                    <!-- Passo 5 -->
                    <div class="relative flex items-start md:items-center md:space-x-8">
                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-teal-500 text-white flex items-center justify-center font-bold text-lg z-10">5</div>
                        <div class="flex-grow bg-white p-6 rounded-xl shadow-lg">
                            <h4 class="text-xl font-semibold mb-2">Restaura√ß√£o dos Dados</h4>
                            <p class="text-slate-600">Finalmente, copie os arquivos do seu backup de volta para o computador. Seu sistema est√° agora limpo, otimizado e com seus dados de volta.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o de Seguran√ßa -->
        <section id="seguranca" class="mb-16 md:mb-24 scroll-mt-16">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold mb-2">Prote√ß√£o Avan√ßada de Dados</h2>
                <p class="text-md text-slate-500">A formata√ß√£o √© apenas o come√ßo. Aprenda a proteger suas informa√ß√µes de forma proativa.</p>
            </div>
            <div class="grid md:grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h4 class="text-xl font-semibold mb-3 text-teal-700">Backup Automatizado</h4>
                    <p class="text-slate-600">Explore softwares de backup que criam c√≥pias de seguran√ßa programadas. Para dados mais sens√≠veis, use ferramentas que criam "imagens do sistema", permitindo uma restaura√ß√£o completa em caso de necessidade.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h4 class="text-xl font-semibold mb-3 text-teal-700">Criptografia de Disco</h4>
                    <p class="text-slate-600">Ap√≥s a formata√ß√£o, ative a criptografia de disco. Ferramentas como BitLocker (Windows) e FileVault (macOS) protegem seus arquivos, tornando-os ileg√≠veis caso o computador seja roubado ou perdido.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h4 class="text-xl font-semibold mb-3 text-teal-700">Destrui√ß√£o Segura de Dados</h4>
                    <p class="text-slate-600">Ao vender ou descartar um disco, a formata√ß√£o n√£o basta. Use softwares de "limpeza segura" que sobrescrevem o disco v√°rias vezes. Em casos extremes, a destrui√ß√£o f√≠sica √© a √∫nica garantia.</p>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o do Quiz -->
        <section id="quiz" class="scroll-mt-16">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold mb-2">Teste seus Conhecimentos</h2>
                    <p class="text-md text-slate-500">Complete o quiz para avaliar sua compreens√£o sobre formata√ß√£o e seguran√ßa de dados.</p>
                </div>

                <div id="quiz-container">
                    <div id="quiz-start-screen">
                        <div class="mb-6">
                            <label for="student-name" class="block text-sm font-medium text-slate-700 mb-1">Nome do Aluno(a):</label>
                            <input type="text" id="student-name" name="student-name" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm" placeholder="Digite seu nome completo">
                            <div id="student-name-error" class="text-red-500 text-xs mt-1"></div>
                        </div>
                        <p class="text-center text-slate-600 mb-6">S√£o 44 perguntas para testar seu conhecimento. Clique abaixo para come√ßar!</p>
                        <div class="text-center">
                            <button id="start-quiz-btn" class="bg-teal-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-teal-700 transition-colors">Iniciar Quiz</button>
                        </div>
                    </div>

                    <div id="quiz-question-screen" class="hidden">
                        <div class="text-center mb-4">
                            <p id="quiz-progress" class="text-sm font-medium text-slate-500">Pergunta 1 de 44</p>
                            <div class="w-full bg-slate-200 rounded-full h-2.5 mt-2">
                                <div id="quiz-progress-bar" class="bg-teal-500 h-2.5 rounded-full" style="width: 2.27%"></div>
                            </div>
                             <p id="quiz-attempt-info" class="text-center text-xs text-slate-500 mt-2 mb-1"></p> <!-- Attempt Number Display -->
                        </div>
                        <div id="question-timer-display" class="text-center text-sm text-slate-600 my-3">Tempo: 00:00.000</div>
                        <h3 id="quiz-question" class="text-xl font-semibold text-center my-6"></h3>
                        <div id="quiz-options" class="space-y-4"></div>
                        <div id="quiz-message" class="text-red-500 text-sm text-center mt-4 mb-2 h-5"></div>
                        <div class="mt-8 flex justify-between items-center">
                           <button id="prev-question-btn" class="bg-slate-200 text-slate-700 font-bold py-2 px-6 rounded-lg hover:bg-slate-300 transition-colors">Anterior</button>
                           <button id="next-question-btn" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-teal-700 transition-colors">Pr√≥xima</button>
                        </div>
                    </div>

                    <div id="quiz-results-screen" class="hidden">
                        <h3 class="text-2xl font-bold text-center mb-4">Quiz Finalizado!</h3>
                        <div class="text-center text-lg text-slate-600 mb-6">
                            <p>Aluno(a): <span id="results-student-name" class="font-bold text-teal-700"></span></p>
                            <p>Tentativa N¬∫: <span id="results-attempt-number" class="font-bold"></span></p> <!-- Attempt Number on Results -->
                            <p>Voc√™ acertou <span id="quiz-score" class="font-bold text-teal-600">0</span> de <span id="quiz-total" class="font-bold">44</span> perguntas.</p>
                            <p id="quiz-percentage" class="text-3xl font-bold mt-2 text-teal-500">0%</p>
                        </div>
                        <div id="quiz-feedback" class="text-center text-slate-700 font-medium mb-8"></div>
                        <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                            <button id="restart-quiz-btn" class="w-full sm:w-auto bg-slate-200 text-slate-700 font-bold py-3 px-6 rounded-lg hover:bg-slate-300 transition-colors">Tentar Novamente</button>
                            <button id="download-pdf-btn" class="w-full sm:w-auto bg-teal-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-700 transition-colors">Baixar Relat√≥rio em PDF</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-slate-800 text-white mt-16 md:mt-24">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 text-center text-sm">
            <p>&copy; 2024 Guia Interativo de Formata√ß√£o. Conte√∫do adaptado de "Desvendando a Formata√ß√£o: Um Guia Essencial para seu Computador".</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('main section');

            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.4 
            };

            const observer = new IntersectionObserver((entries) => {
                let activeSectionId = null;
                entries.forEach(entry => {
                    if (entry.isIntersecting && entry.intersectionRatio >= 0.4) {
                         activeSectionId = entry.target.id;
                    }
                });

                if (activeSectionId) {
                    navLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href').substring(1) === activeSectionId) {
                            link.classList.add('active');
                        }
                    });
                } else {
                    let currentScroll = window.pageYOffset || document.documentElement.scrollTop;
                    let foundActive = false;
                    sections.forEach(section => {
                        if (section.offsetTop <= currentScroll + window.innerHeight * 0.5 && 
                            section.offsetTop + section.offsetHeight > currentScroll + window.innerHeight * 0.2) { 
                            navLinks.forEach(link => {
                                link.classList.remove('active');
                                if (link.getAttribute('href').substring(1) === section.id) {
                                    link.classList.add('active');
                                    foundActive = true;
                                }
                            });
                        }
                    });
                    if (!foundActive) { 
                         navLinks.forEach(link => link.classList.remove('active'));
                         if (currentScroll < sections[0].offsetTop) {
                            const firstNavLink = document.querySelector('.nav-link[href="#inicio"]') || document.querySelector('.nav-link[href="#conceitos"]');
                            if(firstNavLink) firstNavLink.classList.add('active');
                         }
                    }
                }
            }, observerOptions);

            sections.forEach(section => {
                observer.observe(section);
            });
            
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                    if (mobileMenu.classList.contains('hidden') === false) {
                        mobileMenu.classList.add('hidden');
                    }
                });
            });

            const storageCtx = document.getElementById('storageChart').getContext('2d');
            new Chart(storageCtx, {
                type: 'bar',
                data: {
                    labels: ['Kilobyte (KB)', 'Megabyte (MB)', 'Gigabyte (GB)', 'Terabyte (TB)', 'Petabyte (PB)'],
                    datasets: [{
                        label: 'Fator de Multiplica√ß√£o (base 1024)',
                        data: [1024, 1024*1024, 1024*1024*1024, 1024*1024*1024*1024, 1024*1024*1024*1024*1024],
                        backgroundColor: [
                            'rgba(15, 118, 110, 0.2)',
                            'rgba(13, 148, 136, 0.4)',
                            'rgba(20, 184, 166, 0.6)',
                            'rgba(45, 212, 191, 0.8)',
                            'rgba(99, 222, 207, 1)'
                        ],
                        borderColor: [
                            'rgba(15, 118, 110, 1)',
                            'rgba(13, 148, 136, 1)',
                            'rgba(20, 184, 166, 1)',
                            'rgba(45, 212, 191, 1)',
                            'rgba(99, 222, 207, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'logarithmic',
                            title: {
                                display: true,
                                text: 'Tamanho em Bytes (Escala Logar√≠tmica)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    let value = context.parsed.y;
                                    if(value >= 1e15) return (value/1e15).toFixed(0) + ' PB (' + (value/1e15).toFixed(2) + ' Quatrilh√µes de Bytes)';
                                    if(value >= 1e12) return (value/1e12).toFixed(0) + ' TB (' + (value/1e12).toFixed(2) + ' Trilh√µes de Bytes)';
                                    if(value >= 1e9) return (value/1e9).toFixed(0) + ' GB (' + (value/1e9).toFixed(2) + ' Bilh√µes de Bytes)';
                                    if(value >= 1e6) return (value/1e6).toFixed(0) + ' MB (' + (value/1e6).toFixed(2) + ' Milh√µes de Bytes)';
                                    if(value >= 1e3) return (value/1e3).toFixed(0) + ' KB (' + value + ' Bytes)';
                                    return value + ' Bytes';
                                }
                            }
                        }
                    }
                }
            });

const initialQuestions = [
    // --- Ger√™ncia de Processos: Defini√ß√£o e Estrutura Fundamental ---
    { id: 1, topic: "Processos", question: "Se um programa entra em um loop infinito, qual 'estado' do processo ele provavelmente estar√° ocupando predominantemente, e qual a implica√ß√£o para o sistema operacional?", options: ["Novo; ocupando espa√ßo em disco excessivo.", "Bloqueado; esperando por uma entrada/sa√≠da.", "Em Execu√ß√£o; monopolizando a CPU e prejudicando a multiprograma√ß√£o.", "Terminado; liberando todos os recursos."], answer: "Em Execu√ß√£o; monopolizando a CPU e prejudicando a multiprograma√ß√£o.", image: "https://source.unsplash.com/random/400x300/?infinite,loop,CPU,monopoly" },
    { id: 2, topic: "Processos", question: "Explique a import√¢ncia da 'compreens√£o da estrutura de um processo' para um desenvolvedor de software de sistema. Quais seriam as consequ√™ncias de ignor√°-la?", options: ["Apenas para saber o PID do processo.", "√â vital para otimizar o uso de recursos e garantir a estabilidade; ignorar pode levar a vazamentos de mem√≥ria e falhas de aplica√ß√£o.", "Serve apenas para depura√ß√£o em produ√ß√£o.", "N√£o h√° consequ√™ncias significativas."], answer: "√â vital para otimizar o uso de recursos e garantir a estabilidade; ignorar pode levar a vazamentos de mem√≥ria e falhas de aplica√ß√£o.", image: "https://source.unsplash.com/random/400x300/?software,developer,stability,system" },
    { id: 3, topic: "Processos", question: "Qual a diferen√ßa fundamental entre um processo no estado 'Pronto' e um processo no estado 'Bloqueado'?", options: ["Pronto est√° aguardando CPU, Bloqueado est√° aguardando um evento (E/S, recurso).", "Pronto est√° em execu√ß√£o, Bloqueado est√° pronto para execu√ß√£o.", "Pronto j√° terminou sua execu√ß√£o, Bloqueado est√° sendo criado.", "Pronto est√° com erro, Bloqueado est√° correto."], answer: "Pronto est√° aguardando CPU, Bloqueado est√° aguardando um evento (E/S, recurso).", image: "https://source.unsplash.com/random/400x300/?process,ready,blocked,state" },

    // --- Threads: Potencializando a Execu√ß√£o Paralela ---
    { id: 4, topic: "Threads", question: "Como o compartilhamento do 'mesmo espa√ßo de endere√ßo' por threads dentro de um processo impacta o desempenho e a complexidade do desenvolvimento?", options: ["Aumenta o isolamento e simplifica a comunica√ß√£o, mas reduz o desempenho.", "Permite comunica√ß√£o eficiente via mem√≥ria compartilhada e menor sobrecarga, mas introduz desafios de sincroniza√ß√£o.", "N√£o tem impacto no desempenho, apenas na seguran√ßa.", "For√ßa cada thread a ter sua pr√≥pria c√≥pia dos dados."], answer: "Permite comunica√ß√£o eficiente via mem√≥ria compartilhada e menor sobrecarga, mas introduz desafios de sincroniza√ß√£o.", image: "https://source.unsplash.com/random/400x300/?shared,memory,threads,synchronization" },
    { id: 5, topic: "Threads", question: "Um sistema multi-core se beneficia mais da utiliza√ß√£o de threads ou de m√∫ltiplos processos independentes para uma √∫nica aplica√ß√£o intensiva em computa√ß√£o? Justifique.", options: ["M√∫ltiplos processos, pois oferecem isolamento completo.", "Threads, devido ao menor overhead na cria√ß√£o e troca de contexto, e compartilhamento eficiente de dados.", "N√£o h√° diferen√ßa, o desempenho √© o mesmo.", "Nenhum dos dois, o benef√≠cio √© m√≠nimo."], answer: "Threads, devido ao menor overhead na cria√ß√£o e troca de contexto, e compartilhamento eficiente de dados.", image: "https://source.unsplash.com/random/400x300/?multi-core,threads,performance,concurrency" },
    { id: 6, topic: "Threads", question: "Qual o principal desafio de programa√ß√£o ao se utilizar m√∫ltiplas threads que acessam dados compartilhados?", options: ["Aumento da lat√™ncia de rede.", "Condi√ß√µes de corrida e necessidade de mecanismos de sincroniza√ß√£o para garantir a integridade dos dados.", "Dificuldade em gerenciar o tempo de execu√ß√£o.", "Excesso de consumo de mem√≥ria RAM."], answer: "Condi√ß√µes de corrida e necessidade de mecanismos de sincroniza√ß√£o para garantir a integridade dos dados.", image: "https://source.unsplash.com/random/400x300/?race,condition,synchronization,threads" },

    // --- Comunica√ß√£o Interprocessos (IPC): O Di√°logo no Sistema ---
    { id: 7, topic: "Comunica√ß√£o interprocessos (IPC)", question: "Compare 'Pipes' e 'Mem√≥ria Compartilhada' em termos de complexidade de implementa√ß√£o e velocidade de comunica√ß√£o. Qual √© mais adequado para alta vaz√£o de dados e por qu√™?", options: ["Pipes s√£o mais complexos e lentos; Mem√≥ria Compartilhada √© mais simples e r√°pida, ideal para alta vaz√£o.", "Pipes s√£o mais simples e lentos; Mem√≥ria Compartilhada √© mais complexa e r√°pida, ideal para alta vaz√£o por acesso direto.", "Ambos t√™m a mesma complexidade e velocidade.", "Pipes s√£o unidirecionais, Mem√≥ria Compartilhada √© bidirecional, mas igualmente r√°pida."], answer: "Pipes s√£o mais simples e lentos; Mem√≥ria Compartilhada √© mais complexa e r√°pida, ideal para alta vaz√£o por acesso direto.", image: "https://source.unsplash.com/random/400x300/?IPC,pipes,shared,memory,speed" },
    { id: 8, topic: "Comunica√ß√£o interprocessos (IPC)", question: "Por que a sincroniza√ß√£o √© crucial ao usar Mem√≥ria Compartilhada para IPC, e quais problemas podem surgir sem ela?", options: ["Para criptografar os dados.", "Para evitar condi√ß√µes de corrida, garantindo a integridade dos dados; sem ela, dados podem ser corrompidos ou inconsistentes.", "Para acelerar a comunica√ß√£o.", "Para reduzir o consumo de mem√≥ria."], answer: "Para evitar condi√ß√µes de corrida, garantindo a integridade dos dados; sem ela, dados podem ser corrompidos ou inconsistentes.", image: "https://source.unsplash.com/random/400x300/?synchronization,data,integrity,IPC" },
    { id: 9, topic: "Comunica√ß√£o interprocessos (IPC)", question: "Em um cen√°rio onde m√∫ltiplos processos precisam trocar mensagens ass√≠ncronas e que podem ser persistentes, qual mecanismo IPC seria mais adequado e por qu√™?", options: ["Pipes, por serem simples.", "Mem√≥ria Compartilhada, por ser r√°pida.", "Filas de Mensagens, pois permitem assincronicidade e persist√™ncia das mensagens.", "Sinais, por serem leves."], answer: "Filas de Mensagens, pois permitem assincronicidade e persist√™ncia das mensagens.", image: "https://source.unsplash.com/random/400x300/?message,queue,asynchronous,persistence" },

    // --- Escalonamento de Processos: A Arte de Gerenciar o Tempo ---
    { id: 10, topic: "Escalonamento", question: "Considere um sistema com carga de trabalho mista (tarefas interativas e batch). Qual pol√≠tica de escalonamento seria mais adequada para garantir boa responsividade ao usu√°rio, e por qu√™?", options: ["FIFO, pois √© simples.", "Round-Robin ou Prioridades, pois garantem que tarefas interativas recebam aten√ß√£o rapidamente.", "Apenas Prioridades fixas, sem Round-Robin.", "SJF (Shortest Job First), pois minimiza o tempo de espera."], answer: "Round-Robin ou Prioridades, pois garantem que tarefas interativas recebam aten√ß√£o rapidamente.", image: "https://source.unsplash.com/random/400x300/?scheduling,responsiveness,interactive,batch" },
    { id: 11, topic: "Escalonamento", question: "O que √© 'preemp√ß√£o' no contexto do escalonamento, e por que ela √© fundamental para sistemas operacionais modernos?", options: ["√â a capacidade de um processo terminar sua pr√≥pria execu√ß√£o.", "√â a interrup√ß√£o for√ßada de um processo em execu√ß√£o pelo escalonador para permitir que outro processo execute, essencial para multiprograma√ß√£o e responsividade.", "√â a prioriza√ß√£o de processos longos.", "√â a forma como um processo requisita mais tempo de CPU."], answer: "√â a interrup√ß√£o for√ßada de um processo em execu√ß√£o pelo escalonador para permitir que outro processo execute, essencial para multiprograma√ß√£o e responsividade.", image: "https://source.unsplash.com/random/400x300/?preemption,scheduler,multiprogramming" },
    { id: 12, topic: "Escalonamento", question: "Em um sistema de tempo real r√≠gido, qual caracter√≠stica do escalonamento √© mais cr√≠tica: justi√ßa, vaz√£o ou previsibilidade no tempo de resposta?", options: ["Justi√ßa, para que todos os processos recebam tempo igual.", "Vaz√£o, para processar o m√°ximo de tarefas.", "Previsibilidade no tempo de resposta, pois falhas podem ter consequ√™ncias catastr√≥ficas.", "Baixo overhead do escalonador."], answer: "Previsibilidade no tempo de resposta, pois falhas podem ter consequ√™ncias catastr√≥ficas.", image: "https://source.unsplash.com/random/400x300/?real-time,scheduling,predictability,critical" },

    // --- Ger√™ncia de Mem√≥ria: Uso Direto e B√°sico ---
    { id: 13, topic: "Uso direto de mem√≥ria", question: "Se um processo tenta acessar uma regi√£o de mem√≥ria que n√£o foi alocada a ele em um sistema de uso direto de mem√≥ria, qual √© o resultado t√≠pico e por que o SO atua como 'guardi√£o'?", options: ["O sistema ignora o acesso.", "O processo obt√©m acesso a dados de outro processo, ou ocorre uma falha de segmenta√ß√£o, pois o SO deve proteger a integridade da mem√≥ria.", "O processo solicita mais mem√≥ria automaticamente.", "O sistema operacional reinicia o processo."], answer: "O processo obt√©m acesso a dados de outro processo, ou ocorre uma falha de segmenta√ß√£o, pois o SO deve proteger a integridade da mem√≥ria.", image: "https://source.unsplash.com/random/400x300/?memory,access,violation,segmentation,fault" },
    { id: 14, topic: "Uso direto de mem√≥ria", question: "Qual a desvantagem principal do 'Uso Direto de Mem√≥ria' em um ambiente multiprogramado e como a fragmenta√ß√£o de mem√≥ria se manifesta nesse modelo?", options: ["Apenas a complexidade de implementa√ß√£o.", "Problemas de seguran√ßa e fragmenta√ß√£o externa (espa√ßos livres n√£o cont√≠guos), dificultando a aloca√ß√£o de blocos grandes.", "A lentid√£o no acesso √† mem√≥ria.", "O uso excessivo da CPU."], answer: "Problemas de seguran√ßa e fragmenta√ß√£o externa (espa√ßos livres n√£o cont√≠guos), dificultando a aloca√ß√£o de blocos grandes.", image: "https://source.unsplash.com/random/400x300/?memory,fragmentation,multiprogramming,security" },

    // --- Abstra√ß√£o de Mem√≥ria: O Espa√ßo de Endere√ßamento ---
    { id: 15, topic: "Abstra√ß√£o de mem√≥ria: espa√ßo de endere√ßamento", question: "Explique como o 'espa√ßo de endere√ßamento l√≥gico' contribui para a seguran√ßa e isolamento entre processos em um ambiente multiprogramado.", options: ["Ele aumenta a velocidade da CPU.", "Ele impede que um processo acesse diretamente a mem√≥ria f√≠sica de outro, garantindo isolamento e prevenindo falhas maliciosas ou acidentais.", "Ele duplica a mem√≥ria RAM para cada processo.", "Ele torna a depura√ß√£o de c√≥digo mais dif√≠cil."], answer: "Ele impede que um processo acesse diretamente a mem√≥ria f√≠sica de outro, garantindo isolamento e prevenindo falhas maliciosas ou acidentais.", image: "https://source.unsplash.com/random/400x300/?memory,abstraction,isolation,security" },
    { id: 16, topic: "Abstra√ß√£o de mem√≥ria: espa√ßo de endere√ßamento", question: "Qual o papel da 'unidade de gerenciamento de mem√≥ria (MMU)' no mapeamento de endere√ßos l√≥gicos para f√≠sicos, e por que essa tradu√ß√£o √© transparente para o processo?", options: ["A MMU apenas armazena dados.", "A MMU realiza a tradu√ß√£o de endere√ßos em hardware, e √© transparente para o processo para simplificar a programa√ß√£o e manter o isolamento.", "A MMU gerencia a conex√£o de rede.", "A tradu√ß√£o √© manual e feita pelo programador."], answer: "A MMU realiza a tradu√ß√£o de endere√ßos em hardware, e √© transparente para o processo para simplificar a programa√ß√£o e manter o isolamento.", image: "https://source.unsplash.com/random/400x300/?MMU,memory,translation,hardware" },

    // --- Mem√≥ria Virtual: Al√©m dos Limites F√≠sicos ---
    { id: 17, topic: "Mem√≥ria virtual", question: "Qual a principal vantagem da 'Mem√≥ria Virtual' para a execu√ß√£o de programas maiores que a RAM dispon√≠vel, e como isso impacta a experi√™ncia do usu√°rio?", options: ["Permite que programas rodem mais r√°pido que a CPU.", "Permite carregar apenas as partes necess√°rias do programa na RAM, usando o disco para o restante, melhorando a capacidade de execu√ß√£o e multitarefa.", "Isso n√£o √© poss√≠vel, a RAM √© o limite.", "Causa lentid√£o excessiva e falhas frequentes."], answer: "Permite carregar apenas as partes necess√°rias do programa na RAM, usando o disco para o restante, melhorando a capacidade de execu√ß√£o e multitarefa.", image: "https://source.unsplash.com/random/400x300/?virtual,memory,RAM,paging,performance" },
    { id: 18, topic: "Mem√≥ria virtual", question: "Explique o conceito de 'thrashing' na mem√≥ria virtual e suas consequ√™ncias para o desempenho do sistema.", options: ["√â o aumento da velocidade do disco r√≠gido.", "√â quando o sistema passa a maior parte do tempo trocando p√°ginas entre RAM e disco (swap), resultando em lentid√£o severa devido ao excesso de E/S.", "√â uma t√©cnica de otimiza√ß√£o de cache.", "√â a prote√ß√£o contra acesso indevido √† mem√≥ria."], answer: "√â quando o sistema passa a maior parte do tempo trocando p√°ginas entre RAM e disco (swap), resultando em lentid√£o severa devido ao excesso de E/S.", image: "https://source.unsplash.com/random/400x300/?thrashing,paging,performance,degradation" },
    { id: 19, topic: "Mem√≥ria virtual", question: "Como a mem√≥ria virtual contribui para o isolamento robusto entre processos, mesmo que eles compartilhem o mesmo hardware f√≠sico?", options: ["N√£o h√° isolamento, eles compartilham tudo.", "Cada processo possui seu pr√≥prio espa√ßo de endere√ßamento l√≥gico, que √© mapeado de forma isolada para a mem√≥ria f√≠sica, protegendo a mem√≥ria de um processo do acesso por outro.", "Apenas atrav√©s de senhas de acesso.", "Usando criptografia em tempo real."], answer: "Cada processo possui seu pr√≥prio espa√ßo de endere√ßamento l√≥gico, que √© mapeado de forma isolada para a mem√≥ria f√≠sica, protegendo a mem√≥ria de um processo do acesso por outro.", image: "https://source.unsplash.com/random/400x300/?memory,isolation,virtual,processes" },

    // --- Algoritmos de Substitui√ß√£o de P√°ginas: Otimizando o Desempenho ---
    { id: 20, topic: "Algoritmos de substitui√ß√£o de p√°ginas", question: "Qual a diferen√ßa fundamental entre os algoritmos 'FIFO' e 'LRU' de substitui√ß√£o de p√°ginas em termos de crit√©rio de remo√ß√£o, e qual deles tende a ser mais eficiente na pr√°tica?", options: ["FIFO remove a p√°gina mais antiga; LRU remove a menos utilizada recentemente. LRU √© geralmente mais eficiente.", "FIFO remove a menos utilizada; LRU remove a mais antiga. FIFO √© mais eficiente.", "Ambos s√£o baseados em prioridade. N√£o h√° diferen√ßa significativa na efici√™ncia.", "FIFO √© apenas para sistemas de tempo real, LRU √© para sistemas desktop."], answer: "FIFO remove a p√°gina mais antiga; LRU remove a menos utilizada recentemente. LRU √© geralmente mais eficiente.", image: "https://source.unsplash.com/random/400x300/?FIFO,LRU,page,replacement,efficiency" },
    { id: 21, topic: "Algoritmos de substitui√ß√£o de p√°ginas", question: "Por que o algoritmo '√ìtimo (OPT)' √© impratic√°vel de implementar em um sistema operacional real, apesar de ser o mais eficiente?", options: ["Porque ele exige uma CPU muito r√°pida.", "Porque ele requer conhecimento futuro sobre quais p√°ginas ser√£o referenciadas, o que √© imposs√≠vel em tempo real.", "Porque ele consome muita mem√≥ria RAM.", "Porque √© muito complexo de programar."], answer: "Porque ele requer conhecimento futuro sobre quais p√°ginas ser√£o referenciadas, o que √© imposs√≠vel em tempo real.", image: "https://source.unsplash.com/random/400x300/?optimal,algorithm,future,prediction" },
    { id: 22, topic: "Algoritmos de substitui√ß√£o de p√°ginas", question: "A 'Anomalia de Belady' √© um fen√¥meno que ocorre em qual algoritmo de substitui√ß√£o de p√°ginas e o que ela significa para o desempenho?", options: ["Apenas no LRU; significa que ele √© ineficiente.", "No FIFO; significa que, paradoxalmente, aumentar o n√∫mero de quadros de p√°gina pode *aumentar* o n√∫mero de faltas de p√°gina.", "No OPT; significa que ele nunca atinge o ideal.", "Em todos os algoritmos; √© um erro de hardware."], answer: "No FIFO; significa que, paradoxalmente, aumentar o n√∫mero de quadros de p√°gina pode *aumentar* o n√∫mero de faltas de p√°gina.", image: "https://source.unsplash.com/random/400x300/?Belady,anomaly,FIFO,page,faults" }
];

            const startScreen = document.getElementById('quiz-start-screen');
            const questionScreen = document.getElementById('quiz-question-screen');
            const resultsScreen = document.getElementById('quiz-results-screen');
            
            const studentNameInput = document.getElementById('student-name');
            const studentNameErrorEl = document.getElementById('student-name-error');
            const resultsStudentNameEl = document.getElementById('results-student-name');
            const resultsAttemptNumberEl = document.getElementById('results-attempt-number'); // Added

            const startBtn = document.getElementById('start-quiz-btn');
            const restartBtn = document.getElementById('restart-quiz-btn');
            const downloadPdfBtn = document.getElementById('download-pdf-btn');

            const questionEl = document.getElementById('quiz-question');
            const optionsEl = document.getElementById('quiz-options');
            const progressEl = document.getElementById('quiz-progress');
            const progressBarEl = document.getElementById('quiz-progress-bar');
            const quizMessageEl = document.getElementById('quiz-message'); 
            const timerDisplayEl = document.getElementById('question-timer-display');
            const attemptInfoEl = document.getElementById('quiz-attempt-info'); // Added


            const prevBtn = document.getElementById('prev-question-btn');
            const nextBtn = document.getElementById('next-question-btn');

            let currentQuestionIndex = 0;
            let userAnswers = new Array(quizData.length).fill(null);
            // let studentName = ''; // Replaced by currentStudentNameForQuiz
            
            let questionStartTime = 0; 
            let userTimes = []; 
            let currentTimerInterval = null; 

            let attemptCounts = {}; // Stores { studentName: count }
            let currentStudentNameForQuiz = ''; // Name for the active quiz session

            function formatTime(ms) {
                if (ms === null || ms === undefined) return "00:00.000";
                let totalSeconds = Math.floor(ms / 1000);
                let minutes = Math.floor(totalSeconds / 60);
                let seconds = totalSeconds % 60;
                let millis = ms % 1000;
                return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(millis).padStart(3, '0')}`;
            }
            
            function startQuiz() {
                const name = studentNameInput.value.trim();
                if (name === '') {
                    studentNameErrorEl.textContent = 'Por favor, insira seu nome para come√ßar.';
                    return;
                }
                currentStudentNameForQuiz = name; // Set the active student name for this quiz session
                studentNameErrorEl.textContent = ''; 
                
                // Increment attempt count for the current student
                attemptCounts[currentStudentNameForQuiz] = (attemptCounts[currentStudentNameForQuiz] || 0) + 1;

                // Reset quiz state for the new attempt (answers, times, index)
                currentQuestionIndex = 0;
                userAnswers.fill(null);
                userTimes = new Array(quizData.length).fill(0);
                questionStartTime = 0;
                if (currentTimerInterval) {
                    clearInterval(currentTimerInterval);
                    currentTimerInterval = null;
                }
                
                startScreen.classList.add('hidden');
                resultsScreen.classList.add('hidden');
                questionScreen.classList.remove('hidden');
                quizMessageEl.textContent = ''; 

                // Display attempt number on question screen
                attemptInfoEl.textContent = `Tentativa N¬∫: ${attemptCounts[currentStudentNameForQuiz]}`;
                
                showQuestion();
            }

            function showQuestion() {
                if (currentTimerInterval) {
                    clearInterval(currentTimerInterval);
                }

                const questionData = quizData[currentQuestionIndex];
                questionEl.textContent = questionData.question;
                optionsEl.innerHTML = ''; 

                if (questionData.type === 'boolean') {
                    const options = ['Verdadeiro', 'Falso'];
                    options.forEach(optionText => {
                        const isSelected = (optionText === 'Verdadeiro' && userAnswers[currentQuestionIndex] === true) || (optionText === 'Falso' && userAnswers[currentQuestionIndex] === false);
                        const button = document.createElement('button');
                        button.textContent = optionText;
                        button.className = `w-full text-left p-4 border rounded-lg quiz-option ${isSelected ? 'selected' : ''}`;
                        button.onclick = () => selectAnswer(optionText === 'Verdadeiro');
                        optionsEl.appendChild(button);
                    });
                } else {
                    questionData.options.forEach(optionText => {
                        const isSelected = userAnswers[currentQuestionIndex] === optionText;
                        const button = document.createElement('button');
                        button.textContent = optionText;
                        button.className = `w-full text-left p-4 border rounded-lg quiz-option ${isSelected ? 'selected' : ''}`;
                        button.onclick = () => selectAnswer(optionText);
                        optionsEl.appendChild(button);
                    });
                }

                questionStartTime = Date.now(); 
                
                const initialDisplayTime = userTimes[currentQuestionIndex] || 0;
                timerDisplayEl.textContent = `Tempo: ${formatTime(initialDisplayTime)}`;
                
                let sessionStartTimestamp = Date.now(); 

                currentTimerInterval = setInterval(() => {
                    const currentSessionElapsedTime = Date.now() - sessionStartTimestamp;
                    timerDisplayEl.textContent = `Tempo: ${formatTime(initialDisplayTime + currentSessionElapsedTime)}`;
                }, 100); 


                updateNavigation();
                updateProgress();
                
                if (userAnswers[currentQuestionIndex] === null) {
                    nextBtn.disabled = true;
                    nextBtn.title = "Por favor, selecione uma resposta para continuar.";
                } else {
                    nextBtn.disabled = false;
                    nextBtn.title = "";
                }
                 quizMessageEl.textContent = ''; 
            }

            function recordTimeForCurrentQuestion() {
                if (questionStartTime > 0 && currentQuestionIndex >= 0 && currentQuestionIndex < userTimes.length) {
                    const timeSpentThisSession = Date.now() - questionStartTime;
                    userTimes[currentQuestionIndex] = (userTimes[currentQuestionIndex] || 0) + timeSpentThisSession;
                }
                questionStartTime = 0; 
                if (currentTimerInterval) {
                    clearInterval(currentTimerInterval);
                    currentTimerInterval = null;
                }
            }
            
            function selectAnswer(answer) {
                userAnswers[currentQuestionIndex] = answer;
                quizMessageEl.textContent = ''; 
                
                const optionButtons = optionsEl.querySelectorAll('.quiz-option');
                 optionButtons.forEach(btn => {
                    let btnValue;
                    if (quizData[currentQuestionIndex].type === 'boolean') {
                        btnValue = (btn.textContent === 'Verdadeiro');
                    } else {
                        btnValue = btn.textContent;
                    }
                    if (btnValue === answer) {
                        btn.classList.add('selected');
                    } else {
                        btn.classList.remove('selected');
                    }
                });

                if (userAnswers[currentQuestionIndex] !== null) {
                    nextBtn.disabled = false;
                    nextBtn.title = "";
                }
            }

            function updateNavigation() {
                prevBtn.disabled = currentQuestionIndex === 0;
                if (currentQuestionIndex === quizData.length - 1) {
                    nextBtn.textContent = 'Finalizar';
                } else {
                    nextBtn.textContent = 'Pr√≥xima';
                }
            }

            function updateProgress() {
                const progress = currentQuestionIndex + 1;
                progressEl.textContent = `Pergunta ${progress} de ${quizData.length}`;
                progressBarEl.style.width = `${(progress / quizData.length) * 100}%`;
            }

            function nextQuestion() {
                if (userAnswers[currentQuestionIndex] === null) {
                    quizMessageEl.textContent = 'Por favor, selecione uma resposta para continuar.';
                    return; 
                }
                quizMessageEl.textContent = ''; 
                
                recordTimeForCurrentQuestion(); 

                if (currentQuestionIndex < quizData.length - 1) {
                    currentQuestionIndex++;
                    showQuestion();
                } else {
                    showResults(); 
                }
            }

            function prevQuestion() {
                if (currentQuestionIndex > 0) {
                    recordTimeForCurrentQuestion(); 
                    currentQuestionIndex--;
                    quizMessageEl.textContent = ''; 
                    showQuestion();
                }
            }

            function showResults() {
                recordTimeForCurrentQuestion(); 

                questionScreen.classList.add('hidden');
                resultsScreen.classList.remove('hidden');
                
                resultsStudentNameEl.textContent = currentStudentNameForQuiz; 
                resultsAttemptNumberEl.textContent = attemptCounts[currentStudentNameForQuiz]; // Display attempt

                let score = 0;
                userAnswers.forEach((answer, index) => {
                    if(answer === quizData[index].answer) {
                        score++;
                    }
                });

                const percentage = Math.round((score / quizData.length) * 100);
                document.getElementById('quiz-score').textContent = score;
                document.getElementById('quiz-total').textContent = quizData.length;
                document.getElementById('quiz-percentage').textContent = `${percentage}%`;

                const feedbackEl = document.getElementById('quiz-feedback');
                if (percentage >= 90) {
                    feedbackEl.textContent = "Excelente! Voc√™ √© um mestre da formata√ß√£o e seguran√ßa digital.";
                    feedbackEl.className = "text-center text-green-700 font-medium mb-8";
                } else if (percentage >= 70) {
                    feedbackEl.textContent = "Muito bom! Voc√™ tem um √≥timo conhecimento sobre o assunto.";
                    feedbackEl.className = "text-center text-blue-700 font-medium mb-8";
                } else if (percentage >= 50) {
                    feedbackEl.textContent = "Bom trabalho! Continue estudando para aprimorar alguns conceitos.";
                     feedbackEl.className = "text-center text-yellow-700 font-medium mb-8";
                } else {
                    feedbackEl.textContent = "N√£o desanime. Reveja os conceitos e tente novamente para fixar o conhecimento!";
                    feedbackEl.className = "text-center text-red-700 font-medium mb-8";
                }
            }

            function resetQuizState() {
                // Pre-fill the student name input with the name from the *just completed* quiz for convenience
                if (currentStudentNameForQuiz) {
                    studentNameInput.value = currentStudentNameForQuiz;
                } else {
                    studentNameInput.value = ''; 
                }
                studentNameErrorEl.textContent = '';
                
                // Clear timer and other visual quiz elements specific to question screen
                if (currentTimerInterval) {
                    clearInterval(currentTimerInterval);
                    currentTimerInterval = null;
                }
                timerDisplayEl.textContent = `Tempo: ${formatTime(0)}`;
                attemptInfoEl.textContent = ''; // Clear attempt info on question screen

                // Transition UI back to start screen
                // Quiz-specific data like answers, times, currentQuestionIndex, and attempt counts
                // will be freshly initialized/incremented in startQuiz() when the user starts again.
                startScreen.classList.remove('hidden');
                questionScreen.classList.add('hidden');
                resultsScreen.classList.add('hidden');
                quizMessageEl.textContent = '';
            }
            
            function generatePDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const score = document.getElementById('quiz-score').textContent;
                const total = document.getElementById('quiz-total').textContent;
                const percentage = document.getElementById('quiz-percentage').textContent;
                const feedback = document.getElementById('quiz-feedback').textContent;
                const date = new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' });
                const currentAttemptNumber = attemptCounts[currentStudentNameForQuiz] || 0;


                doc.setFontSize(22);
                doc.text("Relat√≥rio de Desempenho do Quiz", 105, 20, null, null, 'center');
                doc.setFontSize(12);
                doc.text(`Data: ${date}`, 105, 30, null, null, 'center');
                doc.text(`Aluno(a): ${currentStudentNameForQuiz}`, 105, 38, null, null, 'center'); 
                doc.text(`Tentativa N¬∫: ${currentAttemptNumber}`, 105, 46, null, null, 'center'); // Added attempt number
                
                let currentY = 46 + 10; // Start Y position after attempt number

                doc.setFontSize(16);
                doc.text("Seu Resultado:", 20, currentY); 
                currentY += 10;
                doc.setFontSize(12);
                doc.text(`- Pontua√ß√£o: ${score} de ${total} acertos`, 20, currentY); 
                currentY += 10;
                doc.text(`- Percentual de acerto: ${percentage}`, 20, currentY); 
                currentY += 10;
                
                const feedbackLines = doc.splitTextToSize(`- Feedback: ${feedback}`, 170); 
                doc.text(feedbackLines, 20, currentY); 
                currentY += (feedbackLines.length * 7) + 10; // Adjusted spacing
                
                doc.setFontSize(16);
                doc.text("Resumo das Respostas:", 20, currentY);
                currentY += 10;

                userAnswers.forEach((answer, index) => {
                    const questionData = quizData[index];
                    const userAnswerText = answer === null ? "N√£o respondida" : (typeof answer === 'boolean' ? (answer ? 'Verdadeiro' : 'Falso') : answer);
                    const correctAnswerText = typeof questionData.answer === 'boolean' ? (questionData.answer ? 'Verdadeiro' : 'Falso') : questionData.answer;
                    const isCorrect = answer === questionData.answer;
                    const timeTaken = userTimes[index]; 
                    const timeText = formatTime(timeTaken);
                    
                    if (currentY > 260) { 
                        doc.addPage();
                        currentY = 20;
                         doc.setFontSize(12); 
                         doc.text(`Aluno(a): ${currentStudentNameForQuiz} (continua√ß√£o)`, 105, 10, null, null, 'center');
                         currentY = 25; 
                    }
                    
                    doc.setFontSize(10);
                    const questionTextLines = doc.splitTextToSize(`${index + 1}. ${questionData.question}`, 170);
                    doc.setTextColor(isCorrect ? '#166534' : '#991b1b'); 
                    doc.text(questionTextLines, 20, currentY);
                    currentY += (questionTextLines.length * 4) + 2; 

                    doc.setTextColor(0); 
                    const userAnswerLines = doc.splitTextToSize(`Sua resposta: ${userAnswerText}`, 165);
                    doc.text(userAnswerLines, 25, currentY);
                    currentY += (userAnswerLines.length * 4) + 2;

                    if (!isCorrect) {
                       const correctAnswerLines = doc.splitTextToSize(`Resposta correta: ${correctAnswerText}`, 165);
                       doc.setTextColor('#1e40af'); 
                       doc.text(correctAnswerLines, 25, currentY);
                       currentY += (correctAnswerLines.length * 4) + 2;
                       doc.setTextColor(0);
                    }

                    doc.setFontSize(9);
                    doc.setTextColor('#334155'); 
                    doc.text(`Tempo gasto: ${timeText}`, 25, currentY);
                    currentY += 4; 

                    currentY += 6; 
                });

                doc.save(`relatorio-quiz-${currentStudentNameForQuiz.replace(/\s+/g, '_')}-tentativa_${currentAttemptNumber}-${new Date().getTime()}.pdf`);
            }

            startBtn.addEventListener('click', startQuiz);
            restartBtn.addEventListener('click', resetQuizState); 
            nextBtn.addEventListener('click', nextQuestion);
            prevBtn.addEventListener('click', prevQuestion);
            downloadPdfBtn.addEventListener('click', generatePDF);
        });

    </script>
</body>
</html>
